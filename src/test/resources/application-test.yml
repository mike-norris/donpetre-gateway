spring:
  application:
    name: api-gateway-test

  # Use H2 in-memory database for tests
  r2dbc:
    url: r2dbc:h2:mem:///testdb?options=DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password: ""
    pool:
      initial-size: 1
      max-size: 5
      max-idle-time: 30m

  # Disable Flyway for tests - we'll use schema.sql instead
  flyway:
    enabled: false

  # Disable Redis for tests
  data:
    redis:
      host: localhost
      port: 6379
      password: ""
      timeout: 2000ms
      database: 0

  # Minimal cloud gateway configuration for tests
  cloud:
    gateway:
      enabled: true
      routes: []  # No routes for unit tests
      default-filters: []  # No default filters

# Logging Configuration for tests
logging:
  level:
    com.openrangelabs.donpetre: DEBUG
    org.springframework.r2dbc: DEBUG
    io.r2dbc: DEBUG
    org.springframework.security: INFO
    org.springframework.test: INFO
  pattern:
    console: "%clr(%d{HH:mm:ss.SSS}){faint} %clr(%5p) %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n"

# Test JWT Configuration
open-range-labs:
  donpetre:
    security:
      jwt:
        secret: ""  # Empty secret will trigger auto-generation
        expiration: 86400000 # 24 hours
        refresh-expiration: 604800000 # 7 days
        algorithm: HS512
        key-length: 64
        auto-generate-secret: true
      cors:
        allowed-origins: "http://localhost:3000,http://localhost:8080"
        allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH
        allowed-headers: "*"
        allow-credentials: true
        max-age: 3600

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always